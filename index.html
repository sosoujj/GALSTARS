<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pide tu Turno ðŸ“…</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>ðŸŒŸ Sistema de Reservas ðŸŒŸ</h1>
    
    <h2>Pedir Nuevo Turno</h2>
    <form id="formulario-reserva">
        <div class="form-group">
            <label for="nombre">Nombre Completo:</label>
            <input type="text" id="nombre" name="nombre" required>
        </div>
        <div class="form-group">
            <label for="telefono">TelÃ©fono/Contacto:</label>
            <input type="tel" id="telefono" name="telefono" required>
        </div>
        <div class="form-group">
            <label for="fecha">Fecha Deseada:</label>
            <input type="date" id="fecha" name="fecha" required> 
        </div>
        <div class="form-group">
            <label for="hora">Hora Deseada (entre 9:00 y 18:00):</label>
            <input type="time" id="hora" name="hora" required min="09:00" max="18:00">
        </div>
        <button type="submit">Solicitar Turno</button>
        <p id="mensaje-reserva"></p>
    </form>
    
    <hr/>
    
    <h2>ðŸ“… Disponibilidad Actual</h2>
    <p>Las fechas y horas mostradas como **Ocupadas** ya tienen un turno asignado.</p>
    <table id="calendario-disponibilidad">
        </table>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
        // TU CONFIGURACIÃ“N DE FIREBASE (Â¡AJUSTA ESTO!)
        const firebaseConfig = {
            apiKey: "AIzaSyCNQm2jgb54xKYYHk64bXO648NdWm1MZTY",
            authDomain: "galstars-b9eed.firebaseapp.com",
            projectId: "galstars-b9eed",
            storageBucket: "galstars-b9eed.firebasestorage.app",
            messagingSenderId: "711879283881",
            appId: "1:711879283881:web:7dfcf4cdf3feb9468505b8",
            measurementId: "G-0Q4XKYWKTQ" 
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <script src="script.js"></script>
    <script>
      // --- LÃ³gica de InicializaciÃ³n para el Usuario (index.html) ---

document.addEventListener('DOMContentLoaded', () => {
    // Verificamos si existe el formulario para saber si estamos en index.html
    const formulario = document.getElementById('formulario-reserva');
    
    if (formulario) { 
        const fechaInput = document.getElementById('fecha');
        const mensajeReserva = document.getElementById('mensaje-reserva');
        
        // 1. Validar que no se pueda elegir una fecha pasada
        const hoy = new Date();
        const fechaMinima = hoy.toISOString().split('T')[0];
        fechaInput.setAttribute('min', fechaMinima);

        // 2. Manejar el envÃ­o del formulario
        formulario.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const horaSolicitada = document.getElementById('hora').value;
            const horaInicio = '09:00';
            const horaFin = '18:00';
            
            // VALIDACIÃ“N DE HORARIO
            if (horaSolicitada < horaInicio || horaSolicitada > horaFin) {
                mensajeReserva.textContent = `âŒ Lo sentimos, solo se puede reservar entre las ${horaInicio} y las ${horaFin}.`;
                mensajeReserva.style.color = 'var(--color-marron)';
                return; 
            }

            const nuevaReserva = {
                nombre: document.getElementById('nombre').value,
                telefono: document.getElementById('telefono').value,
                fecha: document.getElementById('fecha').value,
                hora: horaSolicitada,
                estado: 'Pendiente' // Estado inicial
            };

            // AÃ±ade la reserva a Firebase
            agregarReserva(nuevaReserva).then(() => {
                formulario.reset();
                mensajeReserva.textContent = "âœ… Tu solicitud ha sido enviada. Espera la confirmaciÃ³n del dueÃ±o.";
                mensajeReserva.style.color = 'var(--color-rosa-fuerte)';
                mostrarDisponibilidad();
            }).catch(() => {
                mensajeReserva.textContent = "ðŸš¨ Error al enviar la reserva. Intenta de nuevo mÃ¡s tarde.";
                mensajeReserva.style.color = 'red';
            });
        });

        // 3. Cargar disponibilidad al inicio
        mostrarDisponibilidad();
    }
});

